# å¾®ä¿¡å…¬ä¼—å·æ–‡ç« ç®¡ç† API ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†å¾®ä¿¡å…¬ä¼—å·å’Œæ–‡ç« çš„ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒè‡ªåŠ¨åˆ›å»ºå…¬ä¼—å·è®°å½•ã€åŒæ­¥æ–‡ç« åˆ—è¡¨ã€å»é‡å­˜å‚¨ç­‰åŠŸèƒ½ã€‚

## ğŸ—„ï¸ æ•°æ®åº“è¡¨ç»“æ„

### 1. å¾®ä¿¡å…¬ä¼—å·è¡¨ (wechat_public_account)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | VARCHAR(100) | ä¸»é”®ï¼Œå¾®ä¿¡å…¬ä¼—å·ID |
| name | VARCHAR(255) | å…¬ä¼—å·åç§°ï¼ˆå¯é€‰ï¼‰ |
| description | TEXT | å…¬ä¼—å·ç®€ä»‹ï¼ˆå¯é€‰ï¼‰ |
| avatar_url | VARCHAR(500) | å…¬ä¼—å·å¤´åƒURLï¼ˆå¯é€‰ï¼‰ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |
| updated_at | DATETIME | æ›´æ–°æ—¶é—´ |

### 2. å¾®ä¿¡æ–‡ç« è¡¨ (wechat_article)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INT | ä¸»é”®ï¼Œè‡ªå¢ID |
| article_id | VARCHAR(255) | å¾®ä¿¡æ–‡ç« ID |
| public_account_id | VARCHAR(100) | å¤–é”®ï¼Œå…³è”å…¬ä¼—å·ID |
| title | VARCHAR(500) | æ–‡ç« æ ‡é¢˜ |
| content | TEXT | æ–‡ç« å†…å®¹ |
| publish_time | DATETIME | å‘å¸ƒæ—¶é—´ |
| url | VARCHAR(1000) | æ–‡ç« é“¾æ¥ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |

**çº¦æŸï¼š**
- `article_id` å’Œ `public_account_id` ç»„åˆå”¯ä¸€ï¼ˆé¿å…åŒä¸€å…¬ä¼—å·çš„æ–‡ç« é‡å¤å­˜å‚¨ï¼‰
- `public_account_id` å¤–é”®å¼•ç”¨ `wechat_public_account.id`

## ğŸ”Œ API æ¥å£

### 1. åŒæ­¥å¾®ä¿¡å…¬ä¼—å·æ–‡ç« åˆ—è¡¨

**æ¥å£åœ°å€ï¼š** `POST /api/wechat/articles/sync`

**åŠŸèƒ½ï¼š**
- æ ¹æ®å…¬ä¼—å·IDè·å–æ–‡ç« åˆ—è¡¨å¹¶å­˜å…¥æ•°æ®åº“
- å¦‚æœå…¬ä¼—å·ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ›å»ºå…¬ä¼—å·åŸºç¡€æ•°æ®
- è‡ªåŠ¨å»é‡ï¼Œé¿å…é‡å¤å­˜å‚¨

**è¯·æ±‚å‚æ•°ï¼š**

```json
{
    "public_account_id": "gh_1234567890abcdef",
    "articles": [
        {
            "article_id": "article_001",
            "title": "æ–‡ç« æ ‡é¢˜",
            "content": "æ–‡ç« å†…å®¹",
            "publish_time": "2024-01-01T12:00:00Z",
            "url": "https://mp.weixin.qq.com/s/xxx"
        },
        {
            "article_id": "article_002",
            "title": "å¦ä¸€ç¯‡æ–‡ç« ",
            "content": "å†…å®¹",
            "publish_time": "2024-01-02T12:00:00Z",
            "url": "https://mp.weixin.qq.com/s/yyy"
        }
    ]
}
```

**å‚æ•°è¯´æ˜ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| public_account_id | string | æ˜¯ | å¾®ä¿¡å…¬ä¼—å·ID |
| articles | array | æ˜¯ | æ–‡ç« åˆ—è¡¨ |
| articles[].article_id | string | æ˜¯ | æ–‡ç« IDï¼ˆç”¨äºå»é‡ï¼‰ |
| articles[].title | string | å¦ | æ–‡ç« æ ‡é¢˜ |
| articles[].content | string | å¦ | æ–‡ç« å†…å®¹ |
| articles[].publish_time | string | å¦ | å‘å¸ƒæ—¶é—´ï¼ˆISOæ ¼å¼ï¼‰ |
| articles[].url | string | å¦ | æ–‡ç« é“¾æ¥ |

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
    "code": 200,
    "message": "åŒæ­¥æˆåŠŸ",
    "data": {
        "total": 10,
        "added": 8,
        "skipped": 2
    }
}
```

**å“åº”å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| code | integer | çŠ¶æ€ç ï¼ˆ200=æˆåŠŸï¼‰ |
| message | string | æç¤ºä¿¡æ¯ |
| data.total | integer | æ€»æ–‡ç« æ•° |
| data.added | integer | æ–°å¢æ–‡ç« æ•° |
| data.skipped | integer | è·³è¿‡æ–‡ç« æ•°ï¼ˆå·²å­˜åœ¨ï¼‰ |

**é”™è¯¯å“åº”ï¼š**

```json
{
    "code": 400,
    "message": "public_account_id å‚æ•°å¿…å¡«"
}
```

```json
{
    "code": 500,
    "message": "åŒæ­¥å¤±è´¥: é”™è¯¯ä¿¡æ¯"
}
```

### 2. è·å–å…¬ä¼—å·æ–‡ç« åˆ—è¡¨

**æ¥å£åœ°å€ï¼š** `GET /api/wechat/articles/{publicAccountId}`

**åŠŸèƒ½ï¼š** è·å–æŒ‡å®šå…¬ä¼—å·å·²å­˜å‚¨çš„æ–‡ç« åˆ—è¡¨

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| publicAccountId | string | æ˜¯ | å¾®ä¿¡å…¬ä¼—å·ID |

**æŸ¥è¯¢å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| page | integer | å¦ | 1 | é¡µç ï¼ˆä»1å¼€å§‹ï¼‰ |
| limit | integer | å¦ | 20 | æ¯é¡µæ•°é‡ï¼ˆæœ€å¤§100ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```
GET /api/wechat/articles/gh_1234567890abcdef?page=1&limit=20
```

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
    "code": 200,
    "message": "success",
    "data": [
        {
            "id": 1,
            "articleId": "article_001",
            "title": "æ–‡ç« æ ‡é¢˜",
            "content": "æ–‡ç« å†…å®¹",
            "publishTime": "2024-01-01T12:00:00+00:00",
            "url": "https://mp.weixin.qq.com/s/xxx",
            "createdAt": "2024-01-01T10:00:00+00:00",
            "publicAccount": {
                "id": "gh_1234567890abcdef",
                "name": null,
                "description": null,
                "avatarUrl": null
            }
        }
    ]
}
```

## ğŸ”„ ä¸šåŠ¡æµç¨‹

### åŒæ­¥æ–‡ç« æµç¨‹

1. **éªŒè¯å…¬ä¼—å·**
   - æ£€æŸ¥å…¬ä¼—å·æ˜¯å¦å­˜åœ¨
   - å¦‚æœä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ›å»ºï¼ˆä»…å¡«å……IDï¼Œå…¶ä»–å­—æ®µä¸ºç©ºï¼‰

2. **å¤„ç†æ–‡ç« åˆ—è¡¨**
   - éå†æ–‡ç« åˆ—è¡¨
   - å¯¹æ¯ç¯‡æ–‡ç« è¿›è¡Œå»é‡æ£€æŸ¥ï¼ˆæ ¹æ® `article_id` + `public_account_id`ï¼‰
   - å¦‚æœä¸å­˜åœ¨ï¼Œæ’å…¥æ–°è®°å½•
   - å¦‚æœå­˜åœ¨ï¼Œè·³è¿‡è¯¥æ–‡ç« 

3. **äº‹åŠ¡å¤„ç†**
   - ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ç¡®ä¿åŸå­æ€§
   - å¦‚æœå‡ºé”™ï¼Œè‡ªåŠ¨å›æ»š

4. **è¿”å›ç»“æœ**
   - è¿”å›åŒæ­¥ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ€»æ•°ã€æ–°å¢æ•°ã€è·³è¿‡æ•°ï¼‰

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ä½¿ç”¨ curl åŒæ­¥æ–‡ç« 

```bash
curl -X POST http://127.0.0.1:8000/api/wechat/articles/sync \
  -H "Content-Type: application/json" \
  -d '{
    "public_account_id": "gh_1234567890abcdef",
    "articles": [
      {
        "article_id": "article_001",
        "title": "æµ‹è¯•æ–‡ç« ",
        "content": "è¿™æ˜¯æ–‡ç« å†…å®¹",
        "publish_time": "2024-01-01T12:00:00Z",
        "url": "https://mp.weixin.qq.com/s/xxx"
      }
    ]
  }'
```

### ä½¿ç”¨ curl è·å–æ–‡ç« åˆ—è¡¨

```bash
curl http://127.0.0.1:8000/api/wechat/articles/gh_1234567890abcdef?page=1&limit=20
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å…¬ä¼—å·IDæ ¼å¼**ï¼šå…¬ä¼—å·IDé€šå¸¸æ˜¯å¾®ä¿¡åˆ†é…çš„ï¼Œæ ¼å¼å¦‚ `gh_xxxxxxxxxxxxx`
2. **å»é‡æœºåˆ¶**ï¼šåŒä¸€å…¬ä¼—å·çš„åŒä¸€æ–‡ç« IDåªä¼šå­˜å‚¨ä¸€æ¬¡
3. **äº‹åŠ¡å®‰å…¨**ï¼šåŒæ­¥æ“ä½œä½¿ç”¨äº‹åŠ¡ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
4. **åˆ†é¡µæŸ¥è¯¢**ï¼šè·å–æ–‡ç« åˆ—è¡¨æ”¯æŒåˆ†é¡µï¼Œé¿å…æ•°æ®é‡è¿‡å¤§
5. **æ—¶é—´æ ¼å¼**ï¼š`publish_time` æ”¯æŒ ISO 8601 æ ¼å¼çš„æ—¶é—´å­—ç¬¦ä¸²

## ğŸ”§ æ‰©å±•è¯´æ˜

### åç»­å¯æ‰©å±•åŠŸèƒ½

1. **å…¬ä¼—å·è¯¦æƒ…åŒæ­¥**ï¼šå¯åˆ›å»ºå•ç‹¬çš„æ¥å£æ¥æ›´æ–°å…¬ä¼—å·çš„è¯¦ç»†ä¿¡æ¯ï¼ˆåç§°ã€å¤´åƒç­‰ï¼‰
2. **æ‰¹é‡åŒæ­¥**ï¼šæ”¯æŒæ‰¹é‡åŒæ­¥å¤šä¸ªå…¬ä¼—å·çš„æ–‡ç« 
3. **å®šæ—¶ä»»åŠ¡**ï¼šå¯é…ç½®å®šæ—¶ä»»åŠ¡è‡ªåŠ¨åŒæ­¥æ–‡ç« 
4. **æ–‡ç« æœç´¢**ï¼šæ”¯æŒæŒ‰æ ‡é¢˜ã€å†…å®¹ç­‰æœç´¢æ–‡ç« 

## ğŸ“š ç›¸å…³æ–‡ä»¶

- Entity: `src/Entity/WechatPublicAccount.php`, `src/Entity/WechatArticle.php`
- Repository: `src/Repository/WechatPublicAccountRepository.php`, `src/Repository/WechatArticleRepository.php`
- Controller: `src/Controller/WechatController.php`
- Migration: `migrations/Version20251104052727.php`


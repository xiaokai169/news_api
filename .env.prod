# =============================================================================
# 生产环境配置文件 - .env.prod
# =============================================================================
#
# 重要安全提醒：
# 1. 此文件包含敏感信息，请勿提交到版本控制系统
# 2. 部署前请将所有占位符替换为实际的生产环境值
# 3. 确保文件权限设置为 600 (仅所有者可读写)
# 4. 定期轮换密钥和密码
# 5. 使用宝塔面板部署时，请确保环境变量正确设置
#
# 使用方法：
# 1. 复制此文件为 .env.local.prod (不提交到版本控制)
# 2. 修改所有占位符值为实际生产环境配置
# 3. 在宝塔面板中设置相应的环境变量
# =============================================================================

###> symfony/framework-bundle ###
# 应用环境设置
APP_ENV=prod
APP_DEBUG=false

# 应用密钥 - 请生成强随机密钥 (64位十六进制)
# 生成命令: php -r 'echo bin2hex(random_bytes(32));'
# 安全要求：必须使用强随机密钥，不得使用默认值或简单密码
APP_SECRET=your_64_character_hex_secret_key_here_minimum_length

# 信任的代理设置 (适用于宝塔面板反向代理)
TRUSTED_PROXIES=127.0.0.1,::1

# 信任的头部信息
TRUSTED_HEADERS=x-forwarded-for,x-forwarded-host,x-forwarded-proto,x-forwarded-port,x-forwarded-prefix
###< symfony/framework-bundle ###

###> CORS 安全配置 ###
# 生产环境CORS设置 - 当前允许所有域名，建议在生产环境中限制为特定域名
# 安全建议：仅允许您的前端域名访问
# 示例：CORS_ALLOW_ORIGIN=https://newsapi.arab-bee.com,https://www.newsapi.arab-bee.com
CORS_ALLOW_ORIGIN=https://newsapi.arab-bee.com,https://www.newsapi.arab-bee.com

# 如果需要多个域名，用逗号分隔
# 示例: CORS_ALLOW_ORIGIN=https://example.com,https://app.example.com
###< CORS 安全配置 ###

###> symfony/routing ###
# 生产环境默认URL配置
DEFAULT_URI=https://newsapi.arab-bee.com/

# 可选：如果使用非标准端口
# DEFAULT_URI=https://yourdomain.com:443
###< symfony/routing ###

###> 数据库配置 - 双数据库架构 ###
# =============================================================================
# 主数据库配置 (业务数据)
# =============================================================================
# 格式: mysql://用户名:密码@主机:端口/数据库名?serverVersion=版本&charset=utf8mb4
#
# 安全配置建议：
# 1. 使用专用数据库用户，限制权限
# 2. 密码使用强密码 (16位以上，包含大小写字母、数字、特殊字符)
# 3. 数据库名称避免使用默认名称
# 4. 宝塔面板部署时使用本地MySQL实例

DATABASE_URL="mysql://biz:FaDrTrJK8nfy76sZ@127.0.0.1:3306/official_website?serverVersion=8.0&charset=utf8mb4"

# =============================================================================
# 用户数据库配置 (用户认证)
# =============================================================================
# 建议使用不同的数据库用户和数据库，提高安全性
USER_DATABASE_URL="mysql://biz:FaDrTrJK8nfy76sZ@127.0.0.1:3306/biz?serverVersion=8.0&charset=utf8mb4"

# 数据库连接池配置 (可选，用于高并发)
# DATABASE_POOL_SIZE=10
# DATABASE_POOL_TIMEOUT=60
###< 数据库配置 ###

###> JWT 认证配置 ###
# =============================================================================
# JWT 密钥配置
#
# 安全建议：
# 1. 密钥使用强随机字符串 (至少32位)
# 2. 定期轮换密钥 (建议每3-6个月)
# 3. 在宝塔面板中存储密钥文件的安全位置
# 4. 设置适当的过期时间

# JWT私钥文件路径
JWT_SECRET_KEY=%kernel.project_dir%/config/jwt/private.pem

# JWT公钥文件路径
JWT_PUBLIC_KEY=%kernel.project_dir%/config/jwt/public.pem

# JWT密钥密码 - 请设置强密码 (建议32位以上)
JWT_PASSPHRASE=your_secure_jwt_passphrase_here_minimum_32_characters

# JWT Token过期时间 (秒)
# 默认1小时，可根据业务需求调整
JWT_TOKEN_TTL=3600

# JWT刷新Token过期时间 (秒)
# 默认7天，用于无感刷新
JWT_REFRESH_TTL=604800
###< JWT 认证配置 ###

###> 缓存配置 ###
# =============================================================================
# 生产环境缓存配置
#
# 宝塔面板部署建议：
# 1. 使用Redis缓存提高性能
# 2. 如果没有Redis，使用文件缓存
# 3. 配置适当的缓存过期时间

# Redis缓存配置 (推荐)
# CACHE_URL=redis://127.0.0.1:6379/0
# REDIS_URL=redis://127.0.0.1:6379/1

# 如果没有Redis，使用文件缓存 (默认)
# APP_CACHE_DRIVER=file

# Doctrine查询缓存配置
# DOCTRINE_QUERY_CACHE_TTL=3600
# DOCTRINE_RESULT_CACHE_TTL=3600
###< 缓存配置 ###

###> 邮件配置 ###
# =============================================================================
# 邮件发送配置 (可选)
#
# 根据实际邮件服务商配置
# 支持SMTP、SendGrid、阿里云邮件推送等

# SMTP配置示例
# MAILER_DSN=smtp://username:password@smtp.example.com:587?encryption=tls

# 阿里云邮件推送示例
# MAILER_Dsn=smtp://accessKeyId:accessSecret@smtpdm.aliyun.com:80?encryption=tls
###< 邮件配置 ###

###> 日志配置 ###
# =============================================================================
# 生产环境日志配置

# 日志级别 (建议生产环境使用 error 或 warning)
# LOG_LEVEL=error

# 日志文件路径 (可选，默认使用Symfony默认路径)
# LOG_FILE=%kernel.project_dir%/var/log/prod.log
###< 日志配置 ###

###> 性能优化配置 ###
# =============================================================================
# 生产环境性能优化

# OPcache配置 (通过宝塔面板PHP设置管理)
# 推荐设置：
# opcache.enable=1
# opcache.memory_consumption=128
# opcache.max_accelerated_files=4000
# opcache.revalidate_freq=60

# HTTP缓存配置
# HTTP_CACHE_ENABLED=true
# HTTP_CACHE_MAX_AGE=3600

# Gzip压缩 (通过宝塔面板Nginx配置)
# gzip on;
# gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
###< 性能优化配置 ###

###> 监控和健康检查 ###
# =============================================================================
# 应用监控配置

# 健康检查端点密钥
# HEALTH_CHECK_SECRET=请设置健康检查密钥

# 性能监控开关
# PERFORMANCE_MONITORING=true

# 错误报告邮箱 (可选)
# ERROR_REPORT_EMAIL=admin@yourdomain.com
###< 监控和健康检查 ###

###> API 文档配置 ###
# =============================================================================
# API文档访问控制

# 生产环境是否启用API文档
# API_DOCS_ENABLED=false

# API文档访问密码 (如果启用)
# API_DOCS_PASSWORD=请设置API文档访问密码
###< API 文档配置 ###

###> 文件上传配置 ###
# =============================================================================
# 文件上传安全配置

# 上传文件大小限制 (字节)
# UPLOAD_MAX_SIZE=10485760  # 10MB

# 允许的文件类型
# UPLOAD_ALLOWED_TYPES=jpg,jpeg,png,gif,pdf,doc,docx

# 文件上传路径
# UPLOAD_PATH=%kernel.project_dir%/public/uploads
###< 文件上传配置 ###

###> 第三方服务配置 ###
# =============================================================================
# 微信公众号配置 (如果使用)
# WECHAT_APP_ID=您的微信AppID
# WECHAT_APP_SECRET=您的微信AppSecret

# 短信服务配置 (如果使用)
# SMS_ACCESS_KEY=您的短信AccessKey
# SMS_ACCESS_SECRET=您的短信AccessSecret

# 对象存储配置 (如果使用OSS/CDN)
# OSS_ACCESS_KEY=您的OSS访问密钥
# OSS_SECRET_KEY=您的OSS访问密钥
# OSS_BUCKET=您的存储桶名称
# OSS_ENDPOINT=您的OSS端点
###< 第三方服务配置 ###

###> 安全增强配置 ###
# =============================================================================
# 额外的安全配置 - 生产环境必须启用

# Session安全配置
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=strict
SESSION_GC_MAXLIFETIME=7200

# CSRF保护
CSRF_PROTECTION=true

# 请求频率限制
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=3600

# SSL/TLS配置 (通过宝塔面板SSL证书管理)
FORCE_SSL=true

# 安全头部配置
SECURITY_HEADERS_ENABLED=true
X_FRAME_OPTIONS=SAMEORIGIN
X_CONTENT_TYPE_OPTIONS=nosniff
X_XSS_PROTECTION="1; mode=block"
STRICT_TRANSPORT_SECURITY="max-age=31536000; includeSubDomains"

# 内容安全策略
CONTENT_SECURITY_POLICY="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'"

# 数据库加密
DB_ENCRYPTION_KEY=your_32_character_db_encryption_key_here

# API访问控制
API_ACCESS_TOKEN_ENABLED=true
API_ACCESS_TOKEN_EXPIRY=7200

# 文件安全配置
FILE_UPLOAD_SCAN_VIRUS=true
FILE_UPLOAD_MAX_SIZE=10485760
FILE_UPLOAD_ALLOWED_TYPES=jpg,jpeg,png,gif,pdf,doc,docx

# 备份加密
BACKUP_ENCRYPTION_ENABLED=true
BACKUP_ENCRYPTION_KEY=your_32_character_backup_key_here

# 审计日志
AUDIT_LOG_ENABLED=true
AUDIT_LOG_RETENTION_DAYS=90

# 安全监控
SECURITY_MONITORING_ENABLED=true
SECURITY_ALERT_EMAIL=admin@arab-bee.com
###< 安全增强配置 ###

###> 宝塔面板特定配置 ###
# =============================================================================
# 宝塔面板部署相关配置

# 网站根目录 (宝塔面板通常为 /www/wwwroot/yourdomain)
# BT_SITE_ROOT=/www/wwwroot/yourdomain

# PHP版本 (确保与宝塔面板PHP版本一致)
# BT_PHP_VERSION=8.2

# Nginx配置 (通过宝塔面板网站设置管理)
# 确保配置了：
# - SSL证书
# - Gzip压缩
# - 静态文件缓存
# - 反向代理 (如果需要)
###< 宝塔面板特定配置 ###

# =============================================================================
# 部署检查清单
# =============================================================================
#
# 部署前请确认以下项目：
#
# □ 1. 替换所有占位符值为实际生产环境值
# □ 2. 生成强随机的APP_SECRET (64位十六进制)
# □ 3. 设置强密码的JWT_PASSPHRASE (最少32字符)
# □ 4. 配置数据库连接信息，使用强密码
# □ 5. 设置正确的CORS_ALLOW_ORIGIN域名 (限制特定域名)
# □ 6. 更新DEFAULT_URI为实际域名
# □ 7. 生成JWT密钥文件 (private.pem, public.pem)
# □ 8. 配置Redis缓存 (如果使用)
# □ 9. 设置邮件服务 (如果需要)
# □ 10. 配置文件上传路径和权限
# □ 11. 设置第三方服务密钥 (如果使用)
# □ 12. 在宝塔面板中配置SSL证书
# □ 13. 设置适当的文件权限 (600, 755等)
# □ 14. 配置Nginx重写规则
# □ 15. 测试所有API端点
# □ 16. 验证用户认证功能
# □ 17. 检查日志记录是否正常
# □ 18. 进行性能测试
# □ 19. 设置监控和告警
# □ 20. 备份配置和数据库
#
# 🔒 安全专项检查清单：
#
# □ 21. 验证数据库密码强度 (16位以上，包含大小写字母、数字、特殊字符)
# □ 22. 确认CORS配置仅允许授权域名
# □ 23. 验证JWT密钥和密码的安全性
# □ 24. 检查所有安全头部配置是否启用
# □ 25. 确认Session安全配置正确
# □ 26. 验证文件上传安全限制
# □ 27. 测试CSRF保护功能
# □ 28. 验证请求频率限制
# □ 29. 检查内容安全策略配置
# □ 30. 确认数据库加密密钥已设置
# □ 31. 验证审计日志功能
# □ 32. 测试安全监控和告警
# □ 33. 进行安全漏洞扫描
# □ 34. 验证备份加密功能
#
# 生成强密码和密钥的命令：
#
# 1. 生成APP_SECRET (64位十六进制)：
#    php -r 'echo bin2hex(random_bytes(32));'
#
# 2. 生成数据库密码 (16位强密码)：
#    openssl rand -base64 16
#
# 3. 生成JWT密钥密码 (32位)：
#    openssl rand -base64 32
#
# 4. 生成数据库加密密钥 (32字符)：
#    openssl rand -base64 24
#
# 5. 生成备份加密密钥 (32字符)：
#    openssl rand -base64 24
#
# 6. 生成JWT密钥文件：
#    openssl genpkey -out config/jwt/private.pem -aes256 -algorithm rsa -pkeyopt rsa_keygen_bits:4096
#    openssl pkey -in config/jwt/private.pem -out config/jwt/public.pem -pubout
#
# 7. 验证密码强度检查：
#    # 确保密码包含：大小写字母、数字、特殊字符，长度至少16位
#
# 宝塔面板部署命令：
# php bin/console cache:clear --env=prod --no-warmup
# php bin/console cache:warmup --env=prod
# php bin/console doctrine:migrations:migrate --env=prod --no-interaction
#
# 安全验证命令：
# php bin/console security:check
# curl -I https://yourdomain.com -k | grep -E "(Strict-Transport-Security|X-Frame-Options|X-Content-Type-Options)"
#
# =============================================================================

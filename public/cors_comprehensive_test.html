<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORSç»¼åˆæµ‹è¯•å·¥å…·</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }

        .test-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }

        .test-button:hover {
            background-color: #0056b3;
        }

        .test-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .config-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success {
            background-color: #28a745;
        }

        .status-error {
            background-color: #dc3545;
        }

        .status-warning {
            background-color: #ffc107;
        }

        .status-info {
            background-color: #17a2b8;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            border-bottom: 2px solid transparent;
        }

        .tab.active {
            border-bottom-color: #007bff;
            color: #007bff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background-color: #007bff;
            transition: width 0.3s ease;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ” CORSç»¼åˆæµ‹è¯•å·¥å…·</h1>

        <!-- é…ç½®åŒºåŸŸ -->
        <div class="test-section">
            <h3>âš™ï¸ æµ‹è¯•é…ç½®</h3>
            <label for="baseUrl">APIåŸºç¡€URL:</label>
            <input type="text" id="baseUrl" class="config-input" value="https://newsapi.arab-bee.com"
                placeholder="è¾“å…¥APIåŸºç¡€URL">

            <label for="testOrigin">æµ‹è¯•Origin:</label>
            <input type="text" id="testOrigin" class="config-input" value="https://ops.arab-bee.com"
                placeholder="è¾“å…¥æµ‹è¯•çš„Origin">

            <button class="test-button" onclick="runAllTests()">ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button class="test-button" onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>
        </div>

        <!-- æ ‡ç­¾é¡µ -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('preflight')">é¢„æ£€è¯·æ±‚æµ‹è¯•</button>
            <button class="tab" onclick="showTab('actual')">å®é™…è¯·æ±‚æµ‹è¯•</button>
            <button class="tab" onclick="showTab('diagnosis')">ç³»ç»Ÿè¯Šæ–­</button>
            <button class="tab" onclick="showTab('logs')">æ—¥å¿—åˆ†æ</button>
        </div>

        <!-- é¢„æ£€è¯·æ±‚æµ‹è¯• -->
        <div id="preflight" class="tab-content active">
            <div class="test-section">
                <h3>âœˆï¸ OPTIONSé¢„æ£€è¯·æ±‚æµ‹è¯•</h3>
                <div id="progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div id="progress-fill" class="progress-fill" style="width: 0%;"></div>
                    </div>
                    <div id="progress-text">æµ‹è¯•è¿›åº¦: 0%</div>
                </div>

                <button class="test-button" onclick="testOptionsRequest('/official-api/news')">æµ‹è¯•
                    /official-api/news</button>
                <button class="test-button" onclick="testOptionsRequest('/official-api/news/1')">æµ‹è¯•
                    /official-api/news/1</button>
                <button class="test-button" onclick="testOptionsRequest('/api/doc')">æµ‹è¯• /api/doc</button>
                <button class="test-button" onclick="testOptionsRequest('/cors_debug_test.php')">æµ‹è¯•
                    /cors_debug_test.php</button>

                <div id="options-result" class="result info" style="display: none;"></div>
            </div>
        </div>

        <!-- å®é™…è¯·æ±‚æµ‹è¯• -->
        <div id="actual" class="tab-content">
            <div class="test-section">
                <h3>ğŸ“¡ å®é™…APIè¯·æ±‚æµ‹è¯•</h3>

                <button class="test-button" onclick="testGetRequest('/official-api/news')">GET
                    /official-api/news</button>
                <button class="test-button" onclick="testPostRequest('/official-api/news')">POST
                    /official-api/news</button>
                <button class="test-button" onclick="testPutRequest('/official-api/news/1')">PUT
                    /official-api/news/1</button>
                <button class="test-button" onclick="testDeleteRequest('/official-api/news/1')">DELETE
                    /official-api/news/1</button>

                <div id="actual-result" class="result info" style="display: none;"></div>
            </div>
        </div>

        <!-- ç³»ç»Ÿè¯Šæ–­ -->
        <div id="diagnosis" class="tab-content">
            <div class="test-section">
                <h3>ğŸ”§ ç³»ç»Ÿè¯Šæ–­</h3>

                <button class="test-button" onclick="runSystemDiagnosis()">è¿è¡Œç³»ç»Ÿè¯Šæ–­</button>
                <button class="test-button" onclick="runProductionFix()">è¿è¡Œç”Ÿäº§ä¿®å¤</button>

                <div id="diagnosis-result" class="result info" style="display: none;"></div>
            </div>
        </div>

        <!-- æ—¥å¿—åˆ†æ -->
        <div id="logs" class="tab-content">
            <div class="test-section">
                <h3>ğŸ“Š æ—¥å¿—åˆ†æ</h3>

                <button class="test-button" onclick="checkErrorLogs()">æ£€æŸ¥é”™è¯¯æ—¥å¿—</button>
                <button class="test-button" onclick="checkAccessLogs()">æ£€æŸ¥è®¿é—®æ—¥å¿—</button>
                <button class="test-button" onclick="checkCorsDebugLog()">æ£€æŸ¥CORSè°ƒè¯•æ—¥å¿—</button>

                <div id="logs-result" class="result info" style="display: none;"></div>
            </div>
        </div>

        <!-- ç»¼åˆç»“æœ -->
        <div class="test-section">
            <h3>ğŸ“‹ æµ‹è¯•æ€»ç»“</h3>
            <div id="summary-result" class="result info" style="display: none;"></div>
        </div>
    </div>

    <script>
        let testResults = {
            preflight: [],
            actual: [],
            diagnosis: [],
            logs: []
        };

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function showTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(current, total) {
            const percentage = Math.round((current / total) * 100);
            document.getElementById('progress-fill').style.width = percentage + '%';
            document.getElementById('progress-text').textContent = `æµ‹è¯•è¿›åº¦: ${percentage}%`;
        }

        // æ˜¾ç¤ºè¿›åº¦å®¹å™¨
        function showProgress() {
            document.getElementById('progress-container').style.display = 'block';
        }

        // éšè—è¿›åº¦å®¹å™¨
        function hideProgress() {
            document.getElementById('progress-container').style.display = 'none';
        }

        // OPTIONSé¢„æ£€è¯·æ±‚æµ‹è¯•
        async function testOptionsRequest(endpoint) {
            const baseUrl = document.getElementById('baseUrl').value;
            const testOrigin = document.getElementById('testOrigin').value;
            const url = baseUrl + endpoint;

            const resultDiv = document.getElementById('options-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯• OPTIONS ' + endpoint + '...';

            try {
                const response = await fetch(url, {
                    method: 'OPTIONS',
                    headers: {
                        'Origin': testOrigin,
                        'Access-Control-Request-Method': 'GET',
                        'Access-Control-Request-Headers': 'Content-Type, Authorization'
                    }
                });

                const corsHeaders = {
                    'access-control-allow-origin': response.headers.get('Access-Control-Allow-Origin'),
                    'access-control-allow-methods': response.headers.get('Access-Control-Allow-Methods'),
                    'access-control-allow-headers': response.headers.get('Access-Control-Allow-Headers'),
                    'access-control-max-age': response.headers.get('Access-Control-Max-Age')
                };

                const result = {
                    endpoint: endpoint,
                    status: response.status,
                    statusText: response.statusText,
                    corsHeaders: corsHeaders,
                    success: response.status === 200 && corsHeaders['access-control-allow-origin'] !== null,
                    timestamp: new Date().toISOString()
                };

                testResults.preflight.push(result);

                let output = `âœ… OPTIONS ${endpoint} æµ‹è¯•å®Œæˆ\n\n`;
                output += `çŠ¶æ€ç : ${response.status} ${response.statusText}\n`;
                output += `CORSå¤´:\n`;
                for (const [key, value] of Object.entries(corsHeaders)) {
                    output += `  ${key}: ${value || 'æœªè®¾ç½®'}\n`;
                }
                output += `\næµ‹è¯•ç»“æœ: ${result.success ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}\n`;
                output += `æ—¶é—´æˆ³: ${result.timestamp}`;

                resultDiv.className = result.success ? 'result success' : 'result error';
                resultDiv.textContent = output;

            } catch (error) {
                const result = {
                    endpoint: endpoint,
                    error: error.message,
                    success: false,
                    timestamp: new Date().toISOString()
                };

                testResults.preflight.push(result);

                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ OPTIONS ${endpoint} æµ‹è¯•å¤±è´¥\n\né”™è¯¯: ${error.message}\næ—¶é—´æˆ³: ${result.timestamp}`;
            }
        }

        // GETè¯·æ±‚æµ‹è¯•
        async function testGetRequest(endpoint) {
            await testActualRequest('GET', endpoint);
        }

        // POSTè¯·æ±‚æµ‹è¯•
        async function testPostRequest(endpoint) {
            await testActualRequest('POST', endpoint, { name: 'Test Article', content: 'Test content' });
        }

        // PUTè¯·æ±‚æµ‹è¯•
        async function testPutRequest(endpoint) {
            await testActualRequest('PUT', endpoint, { name: 'Updated Article', content: 'Updated content' });
        }

        // DELETEè¯·æ±‚æµ‹è¯•
        async function testDeleteRequest(endpoint) {
            await testActualRequest('DELETE', endpoint);
        }

        // å®é™…è¯·æ±‚æµ‹è¯•
        async function testActualRequest(method, endpoint, data = null) {
            const baseUrl = document.getElementById('baseUrl').value;
            const testOrigin = document.getElementById('testOrigin').value;
            const url = baseUrl + endpoint;

            const resultDiv = document.getElementById('actual-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = `æ­£åœ¨æµ‹è¯• ${method} ${endpoint}...`;

            const options = {
                method: method,
                headers: {
                    'Origin': testOrigin,
                    'Content-Type': 'application/json'
                }
            };

            if (data && (method === 'POST' || method === 'PUT')) {
                options.body = JSON.stringify(data);
            }

            try {
                const response = await fetch(url, options);

                const responseData = await response.text();

                const result = {
                    method: method,
                    endpoint: endpoint,
                    status: response.status,
                    statusText: response.statusText,
                    corsHeaders: {
                        'access-control-allow-origin': response.headers.get('Access-Control-Allow-Origin'),
                        'access-control-allow-methods': response.headers.get('Access-Control-Allow-Methods'),
                        'access-control-allow-headers': response.headers.get('Access-Control-Allow-Headers')
                    },
                    response: responseData.substring(0, 500), // é™åˆ¶å“åº”é•¿åº¦
                    success: response.ok || response.status < 400,
                    timestamp: new Date().toISOString()
                };

                testResults.actual.push(result);

                let output = `âœ… ${method} ${endpoint} æµ‹è¯•å®Œæˆ\n\n`;
                output += `çŠ¶æ€ç : ${response.status} ${response.statusText}\n`;
                output += `CORSå¤´:\n`;
                for (const [key, value] of Object.entries(result.corsHeaders)) {
                    output += `  ${key}: ${value || 'æœªè®¾ç½®'}\n`;
                }
                output += `\nå“åº”æ•°æ® (å‰500å­—ç¬¦):\n${result.response}\n`;
                output += `\næµ‹è¯•ç»“æœ: ${result.success ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}\n`;
                output += `æ—¶é—´æˆ³: ${result.timestamp}`;

                resultDiv.className = result.success ? 'result success' : 'result error';
                resultDiv.textContent = output;

            } catch (error) {
                const result = {
                    method: method,
                    endpoint: endpoint,
                    error: error.message,
                    success: false,
                    timestamp: new Date().toISOString()
                };

                testResults.actual.push(result);

                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ${method} ${endpoint} æµ‹è¯•å¤±è´¥\n\né”™è¯¯: ${error.message}\næ—¶é—´æˆ³: ${result.timestamp}`;
            }
        }

        // è¿è¡Œç³»ç»Ÿè¯Šæ–­
        async function runSystemDiagnosis() {
            const baseUrl = document.getElementById('baseUrl').value;
            const resultDiv = document.getElementById('diagnosis-result');

            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨è¿è¡Œç³»ç»Ÿè¯Šæ–­...';

            try {
                const response = await fetch(baseUrl + '/cors_system_diagnosis.php?action=diagnose');
                const diagnosis = await response.json();

                testResults.diagnosis.push(diagnosis);

                let output = `ğŸ”§ ç³»ç»Ÿè¯Šæ–­å®Œæˆ\n\n`;
                output += `è¯Šæ–­çŠ¶æ€: ${diagnosis.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}\n`;
                output += `æ—¶é—´æˆ³: ${diagnosis.timestamp}\n\n`;

                if (diagnosis.diagnosis) {
                    output += `ç¯å¢ƒæ£€æŸ¥:\n`;
                    const env = diagnosis.diagnosis.environment_check;
                    output += `  APP_ENV: ${env.app_env}\n`;
                    output += `  CORS_ALLOW_ORIGIN: ${env.cors_allow_origin}\n\n`;

                    output += `CORSé…ç½®:\n`;
                    const cors = diagnosis.diagnosis.cors_configuration;
                    output += `  Bundleå¯ç”¨: ${cors.cors_bundle_enabled ? 'âœ…' : 'âŒ'}\n`;
                    output += `  é…ç½®æ–‡ä»¶å­˜åœ¨: ${cors.nelmio_cors_file_exists ? 'âœ…' : 'âŒ'}\n\n`;
                }

                if (diagnosis.recommendations && diagnosis.recommendations.length > 0) {
                    output += `å»ºè®®:\n`;
                    diagnosis.recommendations.forEach(rec => {
                        output += `  [${rec.priority}] ${rec.issue}: ${rec.description}\n`;
                    });
                }

                resultDiv.className = diagnosis.success ? 'result success' : 'result error';
                resultDiv.textContent = output;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ç³»ç»Ÿè¯Šæ–­å¤±è´¥\n\né”™è¯¯: ${error.message}`;
            }
        }

        // è¿è¡Œç”Ÿäº§ä¿®å¤
        async function runProductionFix() {
            const baseUrl = document.getElementById('baseUrl').value;
            const resultDiv = document.getElementById('diagnosis-result');

            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨è¿è¡Œç”Ÿäº§ä¿®å¤...';

            try {
                const response = await fetch(baseUrl + '/cors_production_fix.php?action=diagnose&clear_cache=1');
                const fix = await response.json();

                let output = `ğŸ”§ ç”Ÿäº§ä¿®å¤å®Œæˆ\n\n`;
                output += `ä¿®å¤çŠ¶æ€: ${fix.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}\n`;
                output += `æ—¶é—´æˆ³: ${fix.timestamp}\n\n`;

                if (fix.fixes) {
                    output += `åº”ç”¨çš„ä¿®å¤:\n`;
                    output += `  ä¿®å¤æ•°é‡: ${fix.fixes.fixes_applied}\n`;
                    fix.fixes.fixes_list.forEach(fix_item => {
                        output += `  - ${fix_item}\n`;
                    });
                }

                if (fix.recommendations) {
                    output += `\nå»ºè®®:\n`;
                    output += `ç«‹å³æ“ä½œ:\n`;
                    fix.recommendations.immediate_actions.forEach(action => {
                        output += `  ${action}\n`;
                    });
                }

                resultDiv.className = fix.success ? 'result success' : 'result error';
                resultDiv.textContent = output;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ç”Ÿäº§ä¿®å¤å¤±è´¥\n\né”™è¯¯: ${error.message}`;
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            showProgress();
            clearResults();

            const tests = [
                () => testOptionsRequest('/official-api/news'),
                () => testOptionsRequest('/official-api/news/1'),
                () => testGetRequest('/official-api/news'),
                () => runSystemDiagnosis()
            ];

            for (let i = 0; i < tests.length; i++) {
                updateProgress(i, tests.length);
                await tests[i]();
                await new Promise(resolve => setTimeout(resolve, 1000)); // ç­‰å¾…1ç§’
            }

            updateProgress(tests.length, tests.length);
            generateSummary();

            setTimeout(hideProgress, 2000);
        }

        // ç”Ÿæˆæµ‹è¯•æ€»ç»“
        function generateSummary() {
            const summaryDiv = document.getElementById('summary-result');
            summaryDiv.style.display = 'block';

            let output = `ğŸ“‹ CORSæµ‹è¯•æ€»ç»“\n\n`;
            output += `æµ‹è¯•æ—¶é—´: ${new Date().toISOString()}\n\n`;

            // é¢„æ£€è¯·æ±‚ç»Ÿè®¡
            const preflightPassed = testResults.preflight.filter(r => r.success).length;
            const preflightTotal = testResults.preflight.length;
            output += `é¢„æ£€è¯·æ±‚æµ‹è¯•: ${preflightPassed}/${preflightTotal} é€šè¿‡\n`;

            // å®é™…è¯·æ±‚ç»Ÿè®¡
            const actualPassed = testResults.actual.filter(r => r.success).length;
            const actualTotal = testResults.actual.length;
            output += `å®é™…è¯·æ±‚æµ‹è¯•: ${actualPassed}/${actualTotal} é€šè¿‡\n`;

            // è¯Šæ–­ç»Ÿè®¡
            const diagnosisCompleted = testResults.diagnosis.length;
            output += `ç³»ç»Ÿè¯Šæ–­: ${diagnosisCompleted} å®Œæˆ\n\n`;

            // æ€»ä½“çŠ¶æ€
            const totalTests = preflightTotal + actualTotal;
            const totalPassed = preflightPassed + actualPassed;
            const successRate = totalTests > 0 ? Math.round((totalPassed / totalTests) * 100) : 0;

            output += `æ€»ä½“æˆåŠŸç‡: ${successRate}%\n`;

            if (successRate === 100) {
                output += `\nğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼CORSé…ç½®æ­£å¸¸å·¥ä½œã€‚`;
                summaryDiv.className = 'result success';
            } else if (successRate >= 50) {
                output += `\nâš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œéœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥CORSé…ç½®ã€‚`;
                summaryDiv.className = 'result warning';
            } else {
                output += `\nâŒ å¤§éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼ŒCORSé…ç½®å­˜åœ¨ä¸¥é‡é—®é¢˜ã€‚`;
                summaryDiv.className = 'result error';
            }

            summaryDiv.textContent = output;
        }

        // æ¸…é™¤ç»“æœ
        function clearResults() {
            testResults = {
                preflight: [],
                actual: [],
                diagnosis: [],
                logs: []
            };

            document.querySelectorAll('.result').forEach(result => {
                result.style.display = 'none';
                result.textContent = '';
            });
        }

        // æ£€æŸ¥é”™è¯¯æ—¥å¿—ï¼ˆæ¨¡æ‹Ÿï¼‰
        function checkErrorLogs() {
            const resultDiv = document.getElementById('logs-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'ğŸ“Š é”™è¯¯æ—¥å¿—æ£€æŸ¥åŠŸèƒ½éœ€è¦æœåŠ¡å™¨ç«¯æ”¯æŒ\n\nå»ºè®®:\n1. æ£€æŸ¥ /var/log/nginx/error.log\n2. æ£€æŸ¥ /var/log/php_errors.log\n3. æ£€æŸ¥ Symfony var/log ç›®å½•\n4. æŸ¥çœ‹åº”ç”¨é”™è¯¯æ—¥å¿—';
        }

        // æ£€æŸ¥è®¿é—®æ—¥å¿—ï¼ˆæ¨¡æ‹Ÿï¼‰
        function checkAccessLogs() {
            const resultDiv = document.getElementById('logs-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'ğŸ“Š è®¿é—®æ—¥å¿—æ£€æŸ¥åŠŸèƒ½éœ€è¦æœåŠ¡å™¨ç«¯æ”¯æŒ\n\nå»ºè®®:\n1. æ£€æŸ¥ /var/log/nginx/access.log\n2. æŸ¥æ‰¾CORSç›¸å…³çš„è¯·æ±‚\n3. åˆ†æOPTIONSè¯·æ±‚çš„çŠ¶æ€ç \n4. æ£€æŸ¥å“åº”å¤´ä¸­çš„CORSè®¾ç½®';
        }

        // æ£€æŸ¥CORSè°ƒè¯•æ—¥å¿—
        async function checkCorsDebugLog() {
            const baseUrl = document.getElementById('baseUrl').value;
            const resultDiv = document.getElementById('logs-result');

            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨æ£€æŸ¥CORSè°ƒè¯•æ—¥å¿—...';

            try {
                const response = await fetch(baseUrl + '/cors_debug.log');
                if (response.ok) {
                    const logContent = await response.text();
                    const recentLogs = logContent.split('\n').slice(-10).join('\n'); // æœ€è¿‘10è¡Œ

                    resultDiv.className = 'result success';
                    resultDiv.textContent = `ğŸ“Š æœ€è¿‘CORSè°ƒè¯•æ—¥å¿—:\n\n${recentLogs}`;
                } else {
                    resultDiv.className = 'result warning';
                    resultDiv.textContent = 'CORSè°ƒè¯•æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ— æ³•è®¿é—®\n\nè¯·ç¡®ä¿:\n1. CorsDebugSubscriberå·²å¯ç”¨\n2. æ—¥å¿—æ–‡ä»¶å¯å†™\n3. APP_DEBUG=true';
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ æ— æ³•è¯»å–CORSè°ƒè¯•æ—¥å¿—\n\né”™è¯¯: ${error.message}`;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            // ä»URLå‚æ•°è¯»å–é…ç½®
            const urlParams = new URLSearchParams(window.location.search);
            const baseUrl = urlParams.get('baseUrl');
            const testOrigin = urlParams.get('testOrigin');

            if (baseUrl) {
                document.getElementById('baseUrl').value = baseUrl;
            }
            if (testOrigin) {
                document.getElementById('testOrigin').value = testOrigin;
            }
        });
    </script>
</body>

</html>